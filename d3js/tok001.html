<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <style>
.img-overlay-wrap {
  position: relative;
  display: inline-block; /* <= shrinks container to image size */
  transition: transform 150ms ease-in-out;
}

.img-overlay-wrap img { /* <= optional, for responsiveness */
   display: block;
   max-width: 100%;
   height: auto;
}

.img-overlay-wrap svg {
  position: absolute;
  top: 0;
  left: 0;
}
    </style>
</head>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-contour.v1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-scale@4"></script>
<div class="img-overlay-wrap">
    <img src="../pipeline_data/tok001/texture_streets-v12.png" style="width:1560px;height:1560px;"/>
    <div id="dataviz"></div>
</div>
<script>
  d3.json("../pipeline_data/tok001/elevation_d3_brdy5.json", function(data) {
    console.log(data);
  let margin = {top: 20, right: 20, bottom: 20, left: 20};
  let width = 1600 - margin.left - margin.right;
  let height = 1600 - margin.top - margin.bottom;
  let svg = d3.select("#dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);
  const k = width / data.width;
  const delta = 100;
  const thick = 5;
  let emin = Math.floor(d3.min(data.values)/delta/thick)*delta*thick;
  let emax = Math.ceil(d3.max(data.values)/delta/thick)*delta*thick;
  let thresholds = d3.range(emin, emax, delta);
  console.log(thresholds);
  let color = d3.scaleSequentialLog(d3.extent(thresholds), d3.interpolateMagma);
  let x = d3.scaleLinear([data.x1, data.x2], [0, width]);
  let y = d3.scaleLinear([data.y1, data.y2], [height, 0]);
  let transform = ({type, value, coordinates}) => {
      return {type, value, coordinates: coordinates.map(rings => {
        return rings.map(points => {
          return points.map(([x, y]) => ([
            k * x,
            k * y
          ]));
        });
      })};
    }
  let contours = d3.contours()
    .size([data.width, data.height])
    .thresholds(thresholds)
    (data.values)
    .map(transform);
  let xAxis = g => g
    .attr("transform", `translate(0,${height})`)
    .call(d3.axisTop(x).ticks(width / height * 10))
    .call(g => g.select(".domain").remove())
    .call(g => g.selectAll(".tick").filter(d => x.domain().includes(d)).remove());
  svg.append("g")
      .call(xAxis);
  let yAxis = g => g
    .attr("transform", "translate(-1,0)")
    .call(d3.axisRight(y))
    .call(g => g.select(".domain").remove())
    .call(g => g.selectAll(".tick").filter(d => y.domain().includes(d)).remove());
  svg.append("g")
      .call(yAxis);
  svg
    .selectAll("path")
    .data(contours)
    .enter()
    .append("path")
      .attr("d", d3.geoPath())
      .attr("fill", d => color(d.value))
      .attr("fill-opacity", 0.02)
      .attr("stroke", "steelblue")
      .attr("stroke-linejoin", "round")
      .attr("stroke-width", (d, i) => i % thick ? 0.25 : 1)
  });
</script>